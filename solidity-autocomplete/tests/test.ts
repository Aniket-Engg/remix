import * as assert from 'assert'
import { AutoC } from '../src'

describe('AutocompleteTests', () => {
  describe('find all ContractDefinition(s)', () => {
    const filename: string = 'tests/sol/greeter.sol';
    let tests: Array<string> = [], results: Array<string> = [];

    before(() => {
        results = new AutoC(filename).suggest(`/ * [ @nodeType == 'ContractDefinition' ]`)
    })
    it('should have atleast one suggestion', () => {
        const exp = `[{"baseContracts":[],"contractDependencies":[],"contractKind":"contract","documentation":null,"fullyImplemented":true,"id":26,"linearizedBaseContracts":[26],"name":"Mortal","nodeType":"ContractDefinition","nodes":[{"constant":false,"id":3,"name":"owner","nodeType":"VariableDeclaration","scope":26,"src":"99:21:0","stateVariable":true,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_address_payable","typeString":"address payable"},"typeName":{"id":2,"name":"address","nodeType":"ElementaryTypeName","src":"99:15:0","stateMutability":"payable","typeDescriptions":{"typeIdentifier":"t_address_payable","typeString":"address payable"}},"value":null,"visibility":"internal"},{"body":{"id":11,"nodeType":"Block","src":"241:23:0","statements":[{"expression":{"argumentTypes":null,"id":9,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"argumentTypes":null,"id":6,"name":"owner","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":3,"src":"243:5:0","typeDescriptions":{"typeIdentifier":"t_address_payable","typeString":"address payable"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"argumentTypes":null,"expression":{"argumentTypes":null,"id":7,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":64,"src":"251:3:0","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":8,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"sender","nodeType":"MemberAccess","referencedDeclaration":null,"src":"251:10:0","typeDescriptions":{"typeIdentifier":"t_address_payable","typeString":"address payable"}},"src":"243:18:0","typeDescriptions":{"typeIdentifier":"t_address_payable","typeString":"address payable"}},"id":10,"nodeType":"ExpressionStatement","src":"243:18:0"}]},"documentation":null,"id":12,"implemented":true,"kind":"function","modifiers":[],"name":"mortal","nodeType":"FunctionDefinition","parameters":{"id":4,"nodeType":"ParameterList","parameters":[],"src":"231:2:0"},"returnParameters":{"id":5,"nodeType":"ParameterList","parameters":[],"src":"241:0:0"},"scope":26,"src":"216:48:0","stateMutability":"nonpayable","superFunction":null,"visibility":"public"},{"body":{"id":24,"nodeType":"Block","src":"349:49:0","statements":[{"condition":{"argumentTypes":null,"commonType":{"typeIdentifier":"t_address_payable","typeString":"address payable"},"id":18,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"argumentTypes":null,"expression":{"argumentTypes":null,"id":15,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":64,"src":"355:3:0","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":16,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"sender","nodeType":"MemberAccess","referencedDeclaration":null,"src":"355:10:0","typeDescriptions":{"typeIdentifier":"t_address_payable","typeString":"address payable"}},"nodeType":"BinaryOperation","operator":"==","rightExpression":{"argumentTypes":null,"id":17,"name":"owner","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":3,"src":"369:5:0","typeDescriptions":{"typeIdentifier":"t_address_payable","typeString":"address payable"}},"src":"355:19:0","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"falseBody":null,"id":23,"nodeType":"IfStatement","src":"351:44:0","trueBody":{"expression":{"argumentTypes":null,"arguments":[{"argumentTypes":null,"id":20,"name":"owner","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":3,"src":"389:5:0","typeDescriptions":{"typeIdentifier":"t_address_payable","typeString":"address payable"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_address_payable","typeString":"address payable"}],"id":19,"name":"selfdestruct","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":72,"src":"376:12:0","typeDescriptions":{"typeIdentifier":"t_function_selfdestruct_nonpayable$_t_address_payable_$returns$__$","typeString":"function (address payable)"}},"id":21,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"376:19:0","typeDescriptions":{"typeIdentifier":"t_tuple$__$","typeString":"tuple()"}},"id":22,"nodeType":"ExpressionStatement","src":"376:19:0"}}]},"documentation":null,"id":25,"implemented":true,"kind":"function","modifiers":[],"name":"kill","nodeType":"FunctionDefinition","parameters":{"id":13,"nodeType":"ParameterList","parameters":[],"src":"339:2:0"},"returnParameters":{"id":14,"nodeType":"ParameterList","parameters":[],"src":"349:0:0"},"scope":26,"src":"326:72:0","stateMutability":"nonpayable","superFunction":null,"visibility":"public"}],"scope":50,"src":"25:375:0"},{"baseContracts":[{"arguments":null,"baseName":{"contractScope":null,"id":27,"name":"Mortal","nodeType":"UserDefinedTypeName","referencedDeclaration":26,"src":"423:6:0","typeDescriptions":{"typeIdentifier":"t_contract$_Mortal_$26","typeString":"contract Mortal"}},"id":28,"nodeType":"InheritanceSpecifier","src":"423:6:0"}],"contractDependencies":[26],"contractKind":"contract","documentation":null,"fullyImplemented":true,"id":49,"linearizedBaseContracts":[49,26],"name":"Greeter","nodeType":"ContractDefinition","nodes":[{"constant":false,"id":30,"name":"greeting","nodeType":"VariableDeclaration","scope":49,"src":"490:15:0","stateVariable":true,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_string_storage","typeString":"string"},"typeName":{"id":29,"name":"string","nodeType":"ElementaryTypeName","src":"490:6:0","typeDescriptions":{"typeIdentifier":"t_string_storage_ptr","typeString":"string"}},"value":null,"visibility":"internal"},{"body":{"id":39,"nodeType":"Block","src":"606:37:0","statements":[{"expression":{"argumentTypes":null,"id":37,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"argumentTypes":null,"id":35,"name":"greeting","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":30,"src":"616:8:0","typeDescriptions":{"typeIdentifier":"t_string_storage","typeString":"string storage ref"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"argumentTypes":null,"id":36,"name":"_greeting","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":32,"src":"627:9:0","typeDescriptions":{"typeIdentifier":"t_string_memory_ptr","typeString":"string memory"}},"src":"616:20:0","typeDescriptions":{"typeIdentifier":"t_string_storage","typeString":"string storage ref"}},"id":38,"nodeType":"ExpressionStatement","src":"616:20:0"}]},"documentation":null,"id":40,"implemented":true,"kind":"constructor","modifiers":[],"name":"","nodeType":"FunctionDefinition","parameters":{"id":33,"nodeType":"ParameterList","parameters":[{"constant":false,"id":32,"name":"_greeting","nodeType":"VariableDeclaration","scope":40,"src":"574:23:0","stateVariable":false,"storageLocation":"memory","typeDescriptions":{"typeIdentifier":"t_string_memory_ptr","typeString":"string"},"typeName":{"id":31,"name":"string","nodeType":"ElementaryTypeName","src":"574:6:0","typeDescriptions":{"typeIdentifier":"t_string_storage_ptr","typeString":"string"}},"value":null,"visibility":"internal"}],"src":"573:25:0"},"returnParameters":{"id":34,"nodeType":"ParameterList","parameters":[],"src":"606:0:0"},"scope":49,"src":"562:81:0","stateMutability":"nonpayable","superFunction":null,"visibility":"public"},{"body":{"id":47,"nodeType":"Block","src":"726:32:0","statements":[{"expression":{"argumentTypes":null,"id":45,"name":"greeting","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":30,"src":"743:8:0","typeDescriptions":{"typeIdentifier":"t_string_storage","typeString":"string storage ref"}},"functionReturnParameters":44,"id":46,"nodeType":"Return","src":"736:15:0"}]},"documentation":null,"id":48,"implemented":true,"kind":"function","modifiers":[],"name":"greet","nodeType":"FunctionDefinition","parameters":{"id":41,"nodeType":"ParameterList","parameters":[],"src":"687:2:0"},"returnParameters":{"id":44,"nodeType":"ParameterList","parameters":[{"constant":false,"id":43,"name":"","nodeType":"VariableDeclaration","scope":48,"src":"711:13:0","stateVariable":false,"storageLocation":"memory","typeDescriptions":{"typeIdentifier":"t_string_memory_ptr","typeString":"string"},"typeName":{"id":42,"name":"string","nodeType":"ElementaryTypeName","src":"711:6:0","typeDescriptions":{"typeIdentifier":"t_string_storage_ptr","typeString":"string"}},"value":null,"visibility":"internal"}],"src":"710:15:0"},"scope":49,"src":"673:85:0","stateMutability":"view","superFunction":null,"visibility":"public"}],"scope":50,"src":"403:357:0"}]`
        assert.deepStrictEqual(JSON.stringify(results), exp)
    })
  })
})
